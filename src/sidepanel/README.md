# 侧边栏 - 翻译抽屉界面

## 概述

侧边栏提供了一个美观、现代的翻译界面，当用户在任何网页上选择文本时显示。它与 Chrome 的原生侧边栏 API 无缝集成。

## 功能

### 🎯 核心功能

1. **即时翻译显示**
   - 清晰的卡片式 UI，显示原文和翻译
   - 支持多种翻译详情（音标、解释、示例）
   - 网络翻译以获取额外上下文

2. **音频发音**
   - 使用 Web Speech API 的文本转语音
   - 回退到有道 TTS 服务
   - 播放期间的视觉反馈

3. **词汇管理**
   - 一键"添加到词汇表"按钮
   - 自动检测已保存的单词
   - 保存单词时的视觉确认

4. **用户体验**
   - 带有帮助说明的空状态
   - 带加载器的加载状态
   - 带重试选项的错误处理
   - 复制翻译到剪贴板
   - 平滑的动画和过渡

### 🎨 UI 组件

#### 空状态
未选择文本时显示，包含：
- 图标和欢迎消息
- 使用说明
- 键盘快捷键提示

#### 翻译视图
显示的主要内容区域：
- 带发音按钮的原文卡片
- 带复制按钮的翻译卡片
- 详细解释列表
- 例句
- 网络翻译

#### 操作页脚
固定页脚包含：
- "添加到词汇表"按钮
- 状态指示（已保存/未保存）

## 架构

```
sidepanel/
├── sidepanel.html       # 入口 HTML 文件
├── index.tsx            # React 初始化
├── App.tsx              # 主应用容器和消息处理
├── TranslationView.tsx  # 核心翻译 UI 组件
├── sidepanel.css        # 自定义样式
└── README.md            # 本文件
```

## 消息流

```
用户 → 选择文本
    ↓
内容脚本 → 后台
    ↓
后台 → 获取/缓存翻译
    ↓
后台 → 侧边栏（TRANSLATION_RESULT 消息）
    ↓
侧边栏 → 用户（显示翻译）
    ↓
用户 → 侧边栏（添加到词汇表）
    ↓
侧边栏 → 后台（SAVE_VOCABULARY 消息）
```

## 状态管理

App 组件管理：
- `selectedText`：当前选择的文本
- `translation`：来自 API 的翻译结果
- `isLoading`：加载状态
- `error`：翻译失败时的错误消息

## 样式

- 使用 Tailwind CSS 实用类
- 用于主题（浅色/深色模式）的自定义 CSS 变量
- 卡片出现的平滑动画
- 自定义滚动条样式
- 不同侧边栏宽度的响应式设计

## 集成点

### 使用的 Chrome API
- `chrome.runtime.onMessage` - 接收翻译结果
- `chrome.storage.local` - 持久化待处理翻译

### 内部依赖
- `storage/db.ts` - IndexedDB 接口
- `storage/vocabularyRepository.ts` - 词汇 CRUD 操作
- `utils/messaging.ts` - 类型安全的 Chrome 消息

## 开发

### 添加新功能

1. **添加新卡片类型**：在 `TranslationView.tsx` 中创建新部分
2. **添加新操作**：在页脚添加按钮和处理函数
3. **添加新消息类型**：更新 `utils/messaging.ts` 并在 `App.tsx` 中处理

### 测试

测试场景：
- 选择单个单词
- 选择短语/句子
- 选择无可用翻译的文本
- 测试音频播放
- 测试词汇保存
- 测试剪贴板复制
- 测试错误状态
- 测试加载状态
- 测试深色模式

## 未来改进

- [ ] 单词难度级别徽章（CEFR：A1-C2）
- [ ] 词汇项目的内联标签
- [ ] 最近翻译的历史记录
- [ ] 侧边栏内搜索
- [ ] 可自定义的 UI 设置（字体大小、颜色）
- [ ] 快速操作（在词典中搜索、网络搜索）
- [ ] 间隔重复提醒
